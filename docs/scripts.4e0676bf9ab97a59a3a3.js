!function(){const t=require("jsbn"),e=(require("jssha"),require("blakejs")),r=t.BigInteger;function n(t){return String.fromCharCode(t)}function i(t){return t.charCodeAt(0)}function o(t,e){result=new Array(e.length);for(var r=0;r<e.length;r++)result[r]=t(e[r]);return result}function s(t){return o(n,t).join("")}function u(t){return o(i,t)}function a(t,e){void 0==e&&(e=1+(t.bitLength()>>3));for(var r=new Array(e),n=0;n<e;n++)r[n]=255&t[0],t=t.shiftRight(8);return r}function c(t){for(var e=p("0"),r=t.length-1;r>-1;r--)e=e.shiftLeft(8).or(p(""+t[r]));return e}function p(t,e){if(void 0!=e)return 256==e?c(u(t)):new r(t,e);if("string"==typeof t)return new r(t,10);if(t instanceof Array)return c(t);if("number"==typeof t)return new r(t.toString(),10);throw"Can't convert "+t+" to BigInteger"}function l(t){return e.blake2b(m)}function f(t){return c(l())}var d=r.ZERO,y=r.ONE,b=p("2");r.prototype.times=r.prototype.multiply,r.prototype.plus=r.prototype.add,r.prototype.minus=r.prototype.subtract,r.prototype.square=function(){return this.times(this)},r.prototype.lesser=function(t){return this.compareTo(t)<0},r.prototype.greater=function(t){return this.compareTo(t)>0},r.prototype.equals=function(t){return 0==this.compareTo(t)},r.prototype.greaterOrEqualTo=function(t){return this.compareTo(t)>=0},r.prototype.lesserOrEqualTo=function(t){return this.compareTo(t)>=0},r.prototype.lesserThan=r.prototype.lesser,r.prototype.greaterThan=r.prototype.greater,r.prototype.equalTo=r.prototype.equals;var h=p("255"),v=p("256"),w=b.pow(p("255")).minus(p("19")),g=b.pow(252).add(p("27742317777372353535851937790883648493")),A=b.pow(v.minus(b)),q=b.pow(251).minus(y).shiftLeft(3);function T(t){return t.mod(w).modInverse(w)}var U=p("-121665").times(T(p("121666"))).mod(w),R=b.modPow(w.minus(y).divide(p("4")),w);function k(t){var e=t.times(t),r=e.minus(y).times(T(y.add(U.times(e)))),n=r.modPow(w.add(p("3")).divide(p("8")),w);return n.times(n).minus(r).mod(w).equals(d)||(n=n.times(R).mod(w)),n.mod(b).equals(d)||(n=w.minus(n)),n}var _=T(p("5")).times(p("4")).mod(w),E=[k(_),_];function B(t,e){var r=t[0],n=t[1],i=e[0],o=e[1],s=U.times(r).times(i).times(n).times(o),u=r.times(o).add(i.times(n)).times(T(y.plus(s))),a=n.times(o).add(r.times(i)).times(T(y.minus(s)));return[u.mod(w),a.mod(w)]}function F(t,e){return function(t){var e=t[0],r=t[1],n=T(t[2]);return[e.times(n).mod(w),r.times(n).mod(w)]}(function t(e,r){if(r.equals(d))return[d,y,y,d];var n,i,o,s,u,a,m,c,p,l,f,h,v,g=t(e,r.shiftRight(1));return o=(n=g)[1],s=n[2],u=(i=n[0]).times(i),a=o.times(o),m=b.times(s).times(s),c=d.minus(u).mod(w),l=(p=i.plus(o).mod(w)).times(p).minus(u).minus(a).mod(w),h=(f=c.plus(a).mod(w)).minus(m).mod(w),v=c.minus(a).mod(w),g=[l.times(h).mod(w),f.times(v).mod(w),h.times(f).mod(w),l.times(v).mod(w)],r.and(y).compareTo(d)?function(t,r){var n=g[0],i=g[1],o=g[2],s=g[3],u=e[0],a=e[1],m=e[2],c=e[3],p=i.minus(n).times(a.plus(u)).mod(w),l=i.plus(n).times(a.minus(u)).mod(w),f=o.times(b).times(c).mod(w),d=s.times(b).times(m).mod(w),y=d.plus(f),h=l.minus(p),v=l.plus(p),A=d.minus(f);return[y.times(h).mod(w),v.times(A).mod(w),h.times(v).mod(w),y.times(A).mod(w)]}():g}(function(t){var e=t[0],r=t[1];return[e,r,y,e.times(r).mod(w)]}(t),e))}function O(t){return a(t,32)}function C(t){return c(t)}function I(t){return O(t[1].add(t[0].and(y).shiftLeft(255)))}function j(t){var e=f(),r=A.add(q.and(e));return I(F(E,r))}function L(t,e,r){var n=f(),i=s(l()),o=A.add(q.and(n)),u=f(i.slice(32,64)),a=F(E,u),m=f((s(I(a)),s(r))),c=u.add(o.times(m)).mod(g);return I(a).concat(O(c))}function H(t){var e=t[0],r=t[1],n=U.times(e).times(e).times(r).times(r).mod(w);return r.times(r).minus(e.times(e)).minus(y).minus(n).mod(w).equals(d)}function S(t){var e=c(t).and(b.pow(h).minus(y));x=k(e),(x.testBit(0)?1:0)!=t[31]>>7&&(x=w.minus(x));var r=[x,e];if(!H(r))throw"Point is not on curve";return r}function Y(t,e,r){var n=S(t.slice(0,32)),i=S(r),o=C(t.slice(32,64)),u=f(s(I(n).concat(r))),a=F(E,o),m=B(n,F(i,u));return a[0].equals(m[0])&&a[1].equals(m[1])}function P(t,e,r){var n=t[0],i=e[0],o=t[1],s=e[1];return[i.times(n).minus(s.times(o)).square().shiftLeft(2).mod(w),i.times(o).minus(s.times(n)).square().shiftLeft(2).times(r).mod(w)]}function M(t){var e=t[0],r=t[1];return[e.square().minus(r.square()).square().mod(w),e.times(r).times(e.square().plus(p("486662").times(e).times(r).plus(r.square()))).shiftLeft(2).mod(w)]}function N(t,e){var r=function(t,e){var r=[e,y],n=M(r);return function t(i){if(i.equals(y))return[r,n];var o=t(i.shiftRight(1)),s=o[0],u=o[1];return i.testBit(0)?[P(s,u,e),M(u)]:[M(s),P(s,u,e)]}(t)}(t,e=e||p("9"));return r[0][0].times(r[0][1].modInverse(w)).mod(w)}module.exports={curve25519:N,isoncurve:H,encodeint:O,decodeint:C,decodepoint:S,encodepoint:I,publickey:j,signature:L,checksig:Y,sig_test:function(t){var e=j();return Y(L(0,0,e),0,e)},dh_test:function(t,e){return pk1=N(t),pk2=N(e),N(t,pk2).equals(N(e,pk1))},inthash:f,bi2bytes:a,bytes2bi:c,bytes2string:s,string2bytes:u,ecDH:N,B:E,l:g,edwards:B,scalarmult:F,scalarmultbase:function(t){return 0==t?[0,1]:F(E,t)}}}(),function(){const t=require("jsbn"),e=require("jssha"),r=require("blakejs"),n=require("./ed25519.js"),i=t.BigInteger;function o(t,e){if(void 0!=e)return 256==e?bytes2bi(string2bytes(t)):new i(t,e);if("string"==typeof t)return new i(t,10);if(t instanceof Array)return bytes2bi(t);if("number"==typeof t)return new i(t.toString(),10);throw"Can't convert "+t+" to BigInteger"}i.prototype.times=i.prototype.multiply,i.prototype.plus=i.prototype.add,i.prototype.minus=i.prototype.subtract,i.prototype.square=function(){return this.times(this)},i.prototype.lesser=function(t){return this.compareTo(t)<0},i.prototype.greater=function(t){return this.compareTo(t)>0},i.prototype.equals=function(t){return 0==this.compareTo(t)},i.prototype.greaterOrEqualTo=function(t){return this.compareTo(t)>=0},i.prototype.lesserOrEqualTo=function(t){return this.compareTo(t)>=0},i.prototype.lesserThan=i.prototype.lesser,i.prototype.greaterThan=i.prototype.greater,i.prototype.equalTo=i.prototype.equals;var s=i.ZERO,u=i.ONE,a=o("2");function m(t){for(var e,r="",n=0;n<t.length;n++)1==(e=t[n].toString(16).toLowerCase()).length&&(e="0"+e),r+=e,e="";return r}function c(t){return r.blake2b(t)}function p(t){var r=new e("SHA-256","ARRAYBUFFER");return r.update(t.buffer),new Uint8Array(r.getHash("ARRAYBUFFER"))}function l(t,r){var n=new e("SHA-512","ARRAYBUFFER");return n.setHMACKey(r.buffer,"ARRAYBUFFER"),n.update(t.buffer),new Uint8Array(n.getHMAC("ARRAYBUFFER"))}function f(t,e){return t|e}function d(t,e){return t&~e}function y(t){if(t.constructor!=Uint8Array)throw"master_secret must be of type 'Uint8Array'";if(32!=t.length)throw"master_secret must be 32 bytes (a Uint8Array of size 32)";var e=c(t),r=e.slice(0,32),i=e.slice(32);return 32&r[31]?null:(r[0]=d(r[0],7),r[31]=d(r[31],128),r[31]=f(r[31],64),[[r,i],n.encodepoint(n.scalarmultbase(n.bytes2bi(r))),p(b([new Uint8Array([1]),t]))])}function b(t){var e=0;t.forEach(function(t){e+=t.length});for(var r=new Uint8Array(e),n=0,i=0;n<t.length;n++)0==n?r.set(t[0]):r.set(t[n],i+=t[n-1].length);return r}function h(t,e){if(e.constructor!=i&&(e=o(e)),!t)return null;var r=t[0][0],u=t[0][1],m=t[1],c=t[2];if(!e.greaterOrEqualTo(s)||!e.lesserThan(a.pow(32)))throw"Index i must be between 0 and 2^32 - 1, inclusive";var p=new Uint8Array(n.bi2bytes(e,4));if(e.lesserThan(a.pow(31)))var f=l(b([new Uint8Array([2]),new Uint8Array(m),p]),c),d=l(b([new Uint8Array([3]),new Uint8Array(m),p]),c).slice(32);else f=l(b([new Uint8Array([0]),r,u,p]),c),d=l(b([new Uint8Array([1]),r,u,p]),c).slice(32);var y=f.slice(0,28),h=f.slice(32),v=n.bytes2bi(y).times(o(8)).plus(n.bytes2bi(r));if(v.mod(n.l).equals(s))return null;var w=n.bytes2bi(h).plus(n.bytes2bi(u)).mod(a.pow(o(256))),g=new Uint8Array(n.bi2bytes(v,32));return[[g,new Uint8Array(n.bi2bytes(w,32))],n.encodepoint(n.scalarmultbase(n.bytes2bi(g))),d]}module.exports={h512:c,h256:p,Fk:l,set_bit:f,clear_bit:d,uint8ToHex:m,hexToUint8:function(t){var e=t.length/2|0,r=new Uint8Array(e);for(let n=0;n<e;n++)r[n]=parseInt(t.substr(2*n,2),16);return r},root_key:y,private_child_key:h,safe_public_child_key:function(t,e,r,c=!0){if(r.constructor!=i&&(r=o(r)),!t||!e)return null;var p=t,f=e;if(!r.greaterOrEqualTo(s)||!r.lesserThan(a.pow(32)))throw"Index i must be between 0 and 2^32 - 1, inclusive";var d=new Uint8Array(n.bi2bytes(r,4));if(!r.lesserThan(a.pow(31)))throw"Can't create hardened child keys from public key";var y=l(b([new Uint8Array([2]),p,d]),f),h=l(b([new Uint8Array([3]),new Uint8Array(p),d]),f).slice(32),v=y.slice(0,28),w=(y.slice(32),n.encodepoint(n.edwards(n.decodepoint(p),n.scalarmultbase(n.bytes2bi(v).times(o(8))))));return n.bytes2bi(w).equals(n.encodepoint([u,s]))?null:c?[m(new Uint8Array(w)),m(h)]:[w,h]},special_signing:function(t,e,r,i){var o=c(b([e,i]));o=n.bytes2bi(o).mod(n.l);var s=n.encodepoint(n.scalarmultbase(o)),u=n.bytes2bi(c(b([s,r,i])));return b([s,n.encodeint(o.plus(u.times(n.bytes2bi(t))).mod(n.l))])},generate_proper_master_secret:function(){for(;;){var t=new Uint8Array(32);if(window.crypto.getRandomValues(t),!(32&c(t).slice(0,32)[31]))break}return t},derive_chain:function(t,e){var r=y(t),n=0;for(e=e.split("/");n<e.length;n++)e[n]&&(e[n]=e[n].endsWith("'")?o(e[n].slice(0,-1)).plus(a.pow(31)):o(e[n]),r=h(r,e[n]));return r}}}();